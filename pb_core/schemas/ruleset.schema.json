{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://pb-core.dev/schemas/ruleset.schema.json",
  "title": "PB Ruleset",
  "description": "Game rules and mode configuration",
  "type": "object",
  "required": ["version"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+$"
    },
    "name": {
      "type": "string",
      "description": "Ruleset display name"
    },
    "mode": {
      "type": "string",
      "enum": ["puzzle", "arcade", "survival", "time_attack", "versus", "coop", "zen"],
      "default": "puzzle"
    },
    "grid": {
      "type": "object",
      "properties": {
        "cols_even": { "type": "integer", "default": 8 },
        "cols_odd": { "type": "integer", "default": 7 },
        "rows": { "type": "integer", "default": 12 }
      }
    },
    "mechanics": {
      "type": "object",
      "properties": {
        "match_threshold": {
          "type": "integer",
          "minimum": 2,
          "maximum": 10,
          "default": 3,
          "description": "Minimum bubbles to pop"
        },
        "max_bounces": {
          "type": "integer",
          "minimum": 0,
          "maximum": 99,
          "default": 2
        },
        "shot_speed": {
          "type": "number",
          "minimum": 1,
          "maximum": 50,
          "default": 8
        },
        "allow_color_switch": {
          "type": "boolean",
          "default": true
        },
        "restrict_colors_to_board": {
          "type": "boolean",
          "default": true,
          "description": "Only generate colors present on board"
        }
      }
    },
    "pressure": {
      "type": "object",
      "description": "Difficulty pressure mechanics",
      "properties": {
        "shots_per_row_insert": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "0 = no row insertion"
        },
        "initial_rows": {
          "type": "integer",
          "minimum": 0,
          "maximum": 20,
          "default": 4
        },
        "ceiling_drop_rate": {
          "type": "integer",
          "minimum": 0,
          "description": "Frames between ceiling drops (0 = disabled)"
        }
      }
    },
    "lose_condition": {
      "type": "string",
      "enum": ["overflow", "timeout", "shots_exhausted"],
      "default": "overflow"
    },
    "colors": {
      "type": "object",
      "properties": {
        "allowed": {
          "type": "array",
          "items": { "type": "integer", "minimum": 0, "maximum": 7 },
          "description": "List of allowed color indices"
        },
        "count": {
          "type": "integer",
          "minimum": 2,
          "maximum": 8,
          "default": 8
        }
      }
    },
    "specials": {
      "type": "object",
      "properties": {
        "allowed": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "bomb", "lightning", "star", "magnetic",
              "rainbow", "shifter", "portal", "ice",
              "split", "virus", "key", "lock"
            ]
          }
        },
        "spawn_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.05,
          "description": "Probability of special bubble spawn"
        }
      }
    },
    "scoring": {
      "type": "object",
      "properties": {
        "base_pop": { "type": "integer", "default": 10 },
        "base_drop": { "type": "integer", "default": 20 },
        "combo_multiplier": { "type": "number", "default": 1.5 },
        "max_combo": { "type": "integer", "default": 10 }
      }
    }
  }
}
